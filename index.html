<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TrueTier – Rank Boosting</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
  <style>
    :root {
      --bg: #060608;
      --surface: #0c0b0f;
      --surface-2: #121118;
      --border: #1c1a22;
      --accent: #ff4655;
      --accent-soft: rgba(255, 70, 85, 0.12);
      --text: #f2f1f4;
      --text-muted: #88849a;
      --radius: 16px;
      --radius-sm: 12px;
      --tp-green: #00b67a;
      --tp-green-dark: #009e6a;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }
    body {
      font-family: 'Outfit', sans-serif;
      background: var(--bg);
      min-height: 100vh;
      color: var(--text);
      overflow-x: hidden;
    }
    .bg-wrap {
      position: fixed;
      inset: 0;
      background: radial-gradient(ellipse 90% 60% at 50% -10%, rgba(255,70,85,0.06) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }
    header {
      position: sticky;
      top: 0;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 1.5rem;
      background: rgba(6, 6, 8, 0.9);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
    }
    .logo { color: var(--accent); font-size: 1.35rem; font-weight: 700; letter-spacing: -0.02em; text-decoration: none; }
    .nav-actions { display: flex; align-items: center; gap: 0.75rem; }
    .btn-outline {
      padding: 0.5rem 1rem;
      background: transparent;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      color: var(--text-muted);
      font-family: inherit;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.2s;
    }
    .btn-outline:hover { border-color: var(--accent); color: var(--accent); }
    .profile-wrap { position: relative; }
    .profile-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.35rem 0.6rem 0.35rem 0.35rem;
      background: var(--surface-2);
      border: 1px solid var(--border);
      border-radius: 999px;
      color: var(--text);
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      transition: border-color 0.2s;
    }
    .profile-btn:hover { border-color: var(--accent); }
    .profile-btn img { width: 28px; height: 28px; border-radius: 50%; object-fit: cover; background: var(--border); }
    .profile-drop {
      position: absolute;
      top: calc(100% + 6px);
      right: 0;
      min-width: 200px;
      background: var(--surface-2);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 1rem;
      display: none;
      box-shadow: 0 16px 40px rgba(0,0,0,0.4);
    }
    .profile-drop.open { display: block; }
    .profile-drop .name { color: var(--accent); font-weight: 600; font-size: 0.95rem; }
    .profile-drop .email { color: var(--text-muted); font-size: 0.8rem; margin-top: 0.2rem; }
    .profile-drop .badges-mini { margin-top: 0.4rem; }
    .badge-mini { display: inline-block; padding: 0.15rem 0.45rem; border-radius: 999px; font-size: 0.65rem; font-weight: 600; margin-right: 0.25rem; }
    .badge-mini.community { background: rgba(99,102,241,0.2); color: #a5b4fc; }
    .badge-mini.customer { background: rgba(34,197,94,0.2); color: #86efac; }
    .profile-drop a { display: block; margin-top: 0.6rem; color: var(--accent); font-size: 0.9rem; text-decoration: none; }
    .profile-drop a:hover { text-decoration: underline; }
    .profile-drop button { width: 100%; margin-top: 0.5rem; padding: 0.5rem; background: var(--border); border: none; border-radius: 8px; color: var(--text); cursor: pointer; font-size: 0.85rem; font-family: inherit; }
    .profile-drop button:hover { background: var(--accent); color: #fff; }
    main { position: relative; z-index: 1; max-width: 920px; margin: 0 auto; padding: 0 1.5rem 3rem; }
    .hero {
      text-align: center;
      padding: 3.5rem 0 2.5rem;
    }
    .hero h1 {
      font-size: clamp(1.85rem, 4vw, 2.75rem);
      font-weight: 700;
      letter-spacing: -0.03em;
      margin-bottom: 0.6rem;
      color: var(--text);
    }
    .hero p { color: var(--text-muted); font-size: 1.05rem; max-width: 480px; margin: 0 auto; }
    /* Trustpilot-style reviews */
    .reviews-section {
      margin-bottom: 3rem;
    }
    .reviews-section .section-head {
      text-align: center;
      margin-bottom: 1.25rem;
    }
    .reviews-section .section-head h2 {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text);
      letter-spacing: -0.02em;
      margin-bottom: 0.5rem;
    }
    .reviews-section .section-head p {
      font-size: 0.9rem;
      color: var(--text-muted);
    }
    .reviews-score-box {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1.25rem;
      flex-wrap: wrap;
      padding: 1.25rem 1.5rem;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      margin-bottom: 1.5rem;
    }
    .reviews-score-box .score-circle {
      width: 72px;
      height: 72px;
      border-radius: 50%;
      background: var(--tp-green);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.75rem;
      font-weight: 700;
      line-height: 1;
    }
    .reviews-score-box .score-info {
      text-align: left;
    }
    .reviews-score-box .score-stars {
      display: flex;
      gap: 2px;
      margin-bottom: 0.25rem;
    }
    .reviews-score-box .score-stars .star { color: var(--tp-green); font-size: 1.25rem; }
    .reviews-score-box .score-label {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 0.15rem;
    }
    .reviews-score-box .score-based {
      font-size: 0.8rem;
      color: var(--text-muted);
    }
    .reviews-strip-wrap {
      position: relative;
      margin: 0 -1.5rem;
      padding: 1.5rem 0;
    }
    .reviews-strip-wrap::before,
    .reviews-strip-wrap::after {
      content: '';
      position: absolute;
      top: 0;
      bottom: 0;
      width: 80px;
      z-index: 2;
      pointer-events: none;
    }
    .reviews-strip-wrap::before {
      left: 0;
      background: linear-gradient(to right, var(--bg) 0%, transparent 100%);
    }
    .reviews-strip-wrap::after {
      right: 0;
      background: linear-gradient(to left, var(--bg) 0%, transparent 100%);
    }
    .reviews-track {
      display: flex;
      gap: 1rem;
      animation: scrollReviews 50s linear infinite;
      width: max-content;
      padding: 0 1.5rem;
    }
    .reviews-track:hover { animation-play-state: paused; }
    @keyframes scrollReviews {
      0% { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }
    .review-card {
      flex-shrink: 0;
      width: 300px;
      padding: 1.25rem 1.35rem;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    .review-card:hover {
      border-color: rgba(0, 182, 122, 0.35);
      box-shadow: 0 6px 24px rgba(0, 0, 0, 0.2);
    }
    .review-card .stars {
      display: flex;
      gap: 2px;
      margin-bottom: 0.5rem;
    }
    .review-card .stars .star { color: var(--tp-green); font-size: 1rem; }
    .review-card .stars .star.empty { color: var(--border); opacity: 0.6; }
    .review-card .rating-label {
      font-size: 0.8rem;
      font-weight: 700;
      color: var(--tp-green);
      margin-bottom: 0.6rem;
      text-transform: uppercase;
      letter-spacing: 0.03em;
    }
    .review-card .text {
      font-size: 0.9rem;
      color: var(--text);
      line-height: 1.55;
      margin-bottom: 1rem;
    }
    .review-card .author-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    .review-card .author-info .name { font-size: 0.85rem; font-weight: 600; color: var(--text); display: block; }
    .review-card .author-info .verified {
      font-size: 0.75rem;
      color: var(--tp-green);
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
    }
    .review-card .author-info .verified::before {
      content: '✓';
      font-weight: 700;
    }
    .review-card.empty-state .rating-label,
    .review-card.empty-state .stars .star { opacity: 0.7; }
    .review-card.empty-state .text { color: var(--text-muted); }
    .review-card.empty-state .author-info .verified { color: var(--text-muted); }
    .announcements { margin-bottom: 2rem; }
    .announcements h2 { font-size: 0.85rem; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem; }
    .announcement {
      background: var(--accent-soft);
      border: 1px solid rgba(255,70,85,0.25);
      border-radius: var(--radius-sm);
      padding: 1.2rem 1.5rem;
      margin-bottom: 0.6rem;
    }
    .announcement h3 { font-size: 0.95rem; color: var(--accent); margin-bottom: 0.3rem; }
    .announcement p { color: var(--text-muted); font-size: 0.88rem; line-height: 1.5; }
    .announcement.empty { border-style: dashed; color: var(--text-muted); }
    .services-section { margin-bottom: 2rem; }
    .services-section .section-head { margin-bottom: 1.5rem; }
    .services-section .section-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text);
      letter-spacing: -0.02em;
      margin-bottom: 0.35rem;
    }
    .services-section .section-desc {
      font-size: 0.95rem;
      color: var(--text-muted);
    }
    .services-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1.25rem;
    }
    .service-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      transition: border-color 0.2s, box-shadow 0.2s, transform 0.2s;
    }
    .service-card:hover {
      border-color: rgba(255, 70, 85, 0.4);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.25);
      transform: translateY(-2px);
    }
    .service-card.featured {
      border-color: rgba(255, 70, 85, 0.5);
      background: linear-gradient(180deg, rgba(255, 70, 85, 0.06) 0%, var(--surface) 100%);
      position: relative;
    }
    .service-card.featured::before {
      content: 'Popular';
      position: absolute;
      top: 0;
      right: 0;
      padding: 0.35rem 0.75rem;
      background: var(--accent);
      color: #fff;
      font-size: 0.7rem;
      font-weight: 700;
      letter-spacing: 0.05em;
      border-radius: 0 var(--radius) 0 10px;
    }
    .service-card .service-name {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 0.4rem;
      line-height: 1.3;
    }
    .service-card .service-desc {
      font-size: 0.88rem;
      color: var(--text-muted);
      line-height: 1.5;
      flex: 1;
      margin-bottom: 1.25rem;
    }
    .service-card .service-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      margin-top: auto;
      padding-top: 1rem;
      border-top: 1px solid var(--border);
    }
    .service-card .service-price {
      font-size: 1.35rem;
      font-weight: 700;
      color: var(--accent);
      letter-spacing: -0.02em;
    }
    .service-card .service-price span { font-size: 0.85rem; font-weight: 600; color: var(--text-muted); }
    .service-card .btn-order {
      padding: 0.6rem 1.25rem;
      background: var(--accent);
      border: none;
      border-radius: var(--radius-sm);
      color: #fff;
      font-family: inherit;
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      transition: background 0.2s, transform 0.05s;
    }
    .service-card .btn-order:hover { background: #e63d4d; transform: scale(1.02); }
    .service-card .btn-order:active { transform: scale(0.98); }
    footer {
      text-align: center;
      padding: 2rem 1.5rem;
      border-top: 1px solid var(--border);
      margin-top: 2rem;
    }
    footer a { color: var(--text-muted); font-size: 0.85rem; text-decoration: none; }
    footer a:hover { color: var(--accent); }
    .banned-screen {
      position: fixed;
      inset: 0;
      z-index: 200;
      background: var(--bg);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      text-align: center;
    }
    .banned-screen.show { display: flex; }
    .banned-screen h2 { color: var(--accent); margin-bottom: 0.5rem; }
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.65);
      backdrop-filter: blur(4px);
      z-index: 150;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
    }
    .modal-overlay.show { display: flex; }
    .modal {
      width: 100%;
      max-width: 420px;
      background: var(--surface-2);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.5rem;
    }
    .modal h3 { font-size: 1.1rem; margin-bottom: 1rem; color: var(--text); }
    .modal label { display: block; font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.35rem; }
    .modal input, .modal textarea {
      width: 100%;
      padding: 0.65rem 1rem;
      margin-bottom: 0.9rem;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      color: var(--text);
      font-family: inherit;
      font-size: 0.95rem;
    }
    .modal textarea { min-height: 90px; resize: vertical; }
    .modal .actions { display: flex; gap: 0.75rem; margin-top: 1rem; }
    .modal .actions button { flex: 1; padding: 0.65rem; border-radius: var(--radius-sm); font-family: inherit; font-size: 0.9rem; font-weight: 500; cursor: pointer; border: none; }
    .modal .actions .primary { background: var(--accent); color: #fff; }
    .modal .actions .secondary { background: var(--border); color: var(--text); }
    .ticket-item { padding: 0.75rem 1rem; background: var(--surface-2); border: 1px solid var(--border); border-radius: var(--radius-sm); margin-bottom: 0.5rem; cursor: pointer; transition: border-color 0.2s; }
    .ticket-item:hover { border-color: var(--accent); }
    .ticket-item strong { display: block; margin-bottom: 0.25rem; }
    .ticket-item span { font-size: 0.85rem; color: var(--text-muted); }
    .ticket-thread-msg { padding: 0.6rem 0.75rem; margin-bottom: 0.5rem; border-radius: var(--radius-sm); font-size: 0.9rem; border-left: 3px solid var(--border); }
    .ticket-thread-msg.admin { background: var(--accent-soft); border-left-color: var(--accent); }
    .ticket-thread-msg .meta { font-size: 0.75rem; color: var(--text-muted); margin-top: 0.25rem; }
    .ticket-thread-msg .attachments { margin-top: 0.5rem; display: flex; flex-wrap: wrap; gap: 0.5rem; }
    .ticket-thread-msg .attachments a { display: block; }
    .ticket-thread-msg .attachments img { max-width: 120px; max-height: 120px; border-radius: 8px; object-fit: cover; border: 1px solid var(--border); }
    .toast {
      position: fixed;
      bottom: 1.5rem;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      padding: 0.75rem 1.25rem;
      background: var(--surface-2);
      border: 1px solid var(--accent);
      border-radius: var(--radius-sm);
      color: var(--text);
      font-size: 0.9rem;
      z-index: 160;
      opacity: 0;
      transition: transform 0.3s, opacity 0.3s;
    }
    .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
    .admin-status-dot {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 0.35rem;
      vertical-align: middle;
    }
    .admin-status-dot.online { background: #22c55e; }
    .admin-status-dot.away { background: #eab308; }
    .admin-status-dot.dnd { background: var(--accent); }
  </style>
</head>
<body>
  <div class="bg-wrap"></div>
  <header>
    <a href="/" class="logo">TrueTier</a>
    <div class="nav-actions">
      <a href="/admin" class="btn-outline">Admin</a>
      <a href="/profile" class="btn-outline" id="navProfile" style="display: none;">Profile</a>
      <button type="button" class="btn-outline" id="btnTicket">Support ticket</button>
      <button type="button" class="btn-outline" id="btnRequestCall">Request call</button>
      <button type="button" class="btn-outline" id="btnReview" style="display:none;">Leave review</button>
      <div class="profile-wrap" id="profileWrap" style="display: none;">
        <button type="button" class="profile-btn" id="profileBtn">
          <img id="profileImg" src="" alt="">
          <span id="profileName">User</span>
          <span style="opacity:0.7;">▼</span>
        </button>
        <div class="profile-drop" id="profileDrop">
          <p class="name" id="profileDropName">–</p>
          <p class="email" id="profileDropEmail">–</p>
          <div class="badges-mini" id="profileDropBadges"></div>
          <a href="/profile">View profile</a>
          <a href="/chat" id="profileDropChat" style="display:none;">Support chat</a>
          <button type="button" id="btnLogout">Log out</button>
        </div>
      </div>
    </div>
  </header>
  <main>
    <section class="hero">
      <h1>Competitive rank boosting</h1>
      <p>Climb with professional boosters. Fast, secure, and trusted by the community.</p>
    </section>
    <section class="reviews-section">
      <div class="section-head">
        <h2>What our customers say</h2>
        <p>Rated excellent by players who climbed with TrueTier</p>
      </div>
      <div class="reviews-score-box" id="reviewsScoreBox">
        <div class="score-circle" id="reviewsScoreNum">–</div>
        <div class="score-info">
          <div class="score-stars" id="reviewsScoreStars"></div>
          <div class="score-label" id="reviewsScoreLabel">No reviews yet</div>
          <div class="score-based" id="reviewsScoreBased">Based on 0 reviews</div>
        </div>
      </div>
      <span style="display:none;" id="reviewsTrack"></span>
          <div class="review-card empty-state" style="display:none;">
            <div class="stars"><span class="star">★</span><span class="star">★</span><span class="star">★</span><span class="star">★</span><span class="star">★</span></div>
            <div class="rating-label">X</div>
            <div class="text">X</div>
            <div class="author-row">
              <div class="author-info"><span class="name">T</span><span class="verified">We’d feedback</span></div>
            </div>
          </div>
      <p style="text-align:center;margin-top:0.75rem;"><a href="/reviews" style="color:var(--tp-green);font-weight:600;font-size:0.95rem;">See all reviews →</a></p>
    </section>
    <section class="announcements">
      <h2>Announcements</h2>
      <div id="announcementsList">
        <div class="announcement empty">No announcements right now.</div>
      </div>
    </section>
    <section class="services-section">
      <div class="section-head">
        <h2 class="section-title">Boost services</h2>
        <p class="section-desc">Choose the option that fits your goals. All boosts are done by verified high-rank players.</p>
      </div>
      <div class="services-grid">
        <div class="service-card featured">
          <div class="service-name">Any rank → Immortal</div>
          <div class="service-desc">Full climb from your current rank to Immortal. Best value for players aiming for the top.</div>
          <div class="service-footer">
            <div class="service-price">$120</div>
            <button type="button" class="btn-order">Order</button>
          </div>
        </div>
        <div class="service-card">
          <div class="service-name">Rank boost – 1 division</div>
          <div class="service-desc">One division climb (e.g. Gold 1 → Gold 2). Quick and affordable.</div>
          <div class="service-footer">
            <div class="service-price">$15</div>
            <button type="button" class="btn-order">Order</button>
          </div>
        </div>
        <div class="service-card">
          <div class="service-name">Rank boost – 1 tier</div>
          <div class="service-desc">Full tier climb (e.g. Gold → Platinum). Includes all divisions in between.</div>
          <div class="service-footer">
            <div class="service-price">$45</div>
            <button type="button" class="btn-order">Order</button>
          </div>
        </div>
        <div class="service-card">
          <div class="service-name">Placement games</div>
          <div class="service-desc">5 placement matches with wins to secure a strong starting rank.</div>
          <div class="service-footer">
            <div class="service-price">$35</div>
            <button type="button" class="btn-order">Order</button>
          </div>
        </div>
        <div class="service-card">
          <div class="service-name">Duo queue</div>
          <div class="service-desc">Play with a booster in your games. Per hour — great for learning and climbing together.</div>
          <div class="service-footer">
            <div class="service-price">$20 <span>/hr</span></div>
            <button type="button" class="btn-order">Order</button>
          </div>
        </div>
      </div>
    </section>
  </main>
  <footer>
    <a href="/admin">Admin login</a>
  </footer>

  <div class="banned-screen" id="bannedScreen">
    <div>
      <h2>Account restricted</h2>
      <p>Your account has been restricted. Contact support if you believe this is an error.</p>
    </div>
  </div>

  <div class="modal-overlay" id="ticketModal">
    <div class="modal ticket-modal" onclick="event.stopPropagation()">
      <div id="ticketScreenCreate">
        <h3>Support ticket</h3>
        <p style="margin-bottom:0.75rem;"><button type="button" class="secondary" id="ticketShowMy">My tickets</button></p>
        <label>Subject</label>
        <input type="text" id="ticketSubject" placeholder="Brief subject">
        <label>Message</label>
        <textarea id="ticketMessage" placeholder="Describe your issue or question..."></textarea>
        <label style="margin-top:0.5rem;">Attach images (optional)</label>
        <input type="file" id="ticketCreateFiles" accept="image/*" multiple style="margin-bottom:0.5rem;font-size:0.9rem;">
        <div class="actions">
          <button type="button" class="secondary" id="ticketCancel">Cancel</button>
          <button type="button" class="primary" id="ticketSubmit">Send</button>
        </div>
      </div>
      <div id="ticketScreenList" style="display:none;">
        <h3>My tickets</h3>
        <p style="margin-bottom:0.75rem;"><button type="button" class="secondary" id="ticketBackToCreate">New ticket</button></p>
        <div id="ticketMyList"></div>
      </div>
      <div id="ticketScreenThread" style="display:none;">
        <h3 id="ticketThreadSubject">Ticket</h3>
        <p style="margin-bottom:0.75rem;"><button type="button" class="secondary" id="ticketBackToList">← Back to list</button></p>
        <div id="ticketThreadMessages"></div>
        <label>Add a message</label>
        <textarea id="ticketReplyText" placeholder="Type your message..."></textarea>
        <label style="margin-top:0.5rem;">Attach images (optional)</label>
        <input type="file" id="ticketReplyFiles" accept="image/*" multiple style="margin-bottom:0.5rem;font-size:0.9rem;">
        <div class="actions">
          <button type="button" class="primary" id="ticketReplySubmit">Send</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="reviewModal">
    <div class="modal" onclick="event.stopPropagation()">
      <h3>Leave a review</h3>
      <label>Your review (customers only)</label>
      <textarea id="reviewText" placeholder="How was your boost experience?"></textarea>
      <label>Rating</label>
      <select id="reviewRating" style="width:100%;padding:0.65rem;background:var(--bg);border:1px solid var(--border);border-radius:var(--radius-sm);color:var(--text);margin-bottom:0.9rem;">
        <option value="5">★★★★★</option>
        <option value="4">★★★★☆</option>
        <option value="3">★★★☆☆</option>
        <option value="2">★★☆☆☆</option>
        <option value="1">★☆☆☆☆</option>
      </select>
      <div class="actions">
        <button type="button" class="secondary" id="reviewCancel">Cancel</button>
        <button type="button" class="primary" id="reviewSubmit">Submit review</button>
      </div>
    </div>
  </div>

We’ll   <div class="toast" id="toast"></div>
  -->’d   <div class="toast" id="toast">  </div>

  <div class="modal-overlay" id="callModal">
    <div class="modal" onclick="event.stopPropagation()">
      <h3>Request a call</h3>
      <p style="font-size:0.9rem;color:var(--text-muted);margin-bottom:1rem;">Leave your number and we'll call you back as soon as we can.</p>
      <label>Phone number</label>
      <input type="tel" id="callPhone" placeholder="Your phone number">
      <label>Brief note (optional)</label>
      <input type="text" id="callNote" placeholder="e.g. best time to call">
      <div class="actions">
        <button type="button" class="secondary" id="callCancel">Cancel</button>
        <button type="button" class="primary" id="callSubmit">Request call</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA8Ir6slVIVLH2ax4Ypd7mgowhIXIl_Qhk",
      authDomain: "truetier-9567f.firebaseapp.com",
      databaseURL: "https://truetier-9567f-default-rtdb.firebaseio.com",
      projectId: "truetier-9567f",
      storageBucket: "truetier-9567f.firebasestorage.app",
      messagingSenderId: "112020148911",
      appId: "1:112020148911:web:ca2338326009d12656ba5a"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();
    const storage = firebase.storage();

    function showToast(msg) {
      var el = document.getElementById('toast');
      el.textContent = msg;
      el.classList.add('show');
      setTimeout(function() { el.classList.remove('show'); }, 3000);
    }

    function escapeHtml(s) {
      if (!s) return '';
      var d = document.createElement('div');
      d.textContent = s;
      return d.innerHTML;
    }

    auth.onAuthStateChanged(function(user) {
      if (!user) {
        window.location.href = '/login';
        return;
      }
      if (!user.emailVerified) {
        auth.signOut();
        window.location.href = '/login';
        return;
      }
      db.ref('bannedUsers/' + user.uid).once('value', function(snap) {
        if (snap.exists()) {
          document.getElementById('bannedScreen').classList.add('show');
          return;
        }
        db.ref('users/' + user.uid).on('value', function(s) {
          var d = s.val() || {};
          if (!d.badges || !d.badges.community) {
            db.ref('users/' + user.uid + '/badges/community').set(true);
          }
          var name = d.displayName || user.email.split('@')[0] || 'User';
          var photo = d.photoURL || user.photoURL || ('https://ui-avatars.com/api/?name=' + encodeURIComponent(user.email) + '&background=1c1a22&color=ff4655');
          document.getElementById('profileWrap').style.display = 'flex';
          var navProfile = document.getElementById('navProfile');
          if (navProfile) navProfile.style.display = 'inline-block';
          document.getElementById('profileName').textContent = name;
          document.getElementById('profileDropName').textContent = name;
          document.getElementById('profileDropEmail').textContent = user.email;
          document.getElementById('profileImg').src = photo;
          document.getElementById('profileImg').alt = name;
          var badges = d.badges || {};
          var badgesHtml = '';
          if (badges.community) badgesHtml += '<span class="badge-mini community">Community</span>';
          if (badges.customer) {
            badgesHtml += '<span class="badge-mini customer">Customer</span>';
            document.getElementById('btnReview').style.display = 'inline-block';
            document.getElementById('profileDropChat').style.display = 'block';
          } else {
            document.getElementById('profileDropChat').style.display = 'none';
          }
          document.getElementById('profileDropBadges').innerHTML = badgesHtml;
        });
      });
    });

    db.ref('reviews').orderByChild('createdAt').limitToLast(50).on('value', function(snap) {
      var track = document.getElementById('reviewsTrack');
      var items = [];
      snap.forEach(function(c) {
        var v = c.val();
        items.push({ text: v.text || '', rating: v.rating || 5, author: v.displayName || 'Customer' });
      });
      var scoreNum = document.getElementById('reviewsScoreNum');
      var scoreStars = document.getElementById('reviewsScoreStars');
      var scoreLabel = document.getElementById('reviewsScoreLabel');
      var scoreBased = document.getElementById('reviewsScoreBased');
      function ratingLabel(n) {
        if (n >= 4.5) return 'Excellent';
        if (n >= 4) return 'Great';
        if (n >= 3) return 'Good';
        if (n >= 2) return 'Average';
        return 'Poor';
      }
      if (items.length > 0) {
        var avg = items.reduce(function(s, r) { return s + Number(r.rating); }, 0) / items.length;
        var rounded = Math.round(avg * 10) / 10;
        scoreNum.textContent = rounded.toFixed(1);
        var starsHtml = '';
        for (var i = 0; i < 5; i++) starsHtml += '<span class="star">★</span>';
        scoreStars.innerHTML = starsHtml;
        scoreLabel.textContent = ratingLabel(rounded);
        scoreBased.textContent = 'Based on ' + items.length + ' review' + (items.length === 1 ? '' : 's');
      } else {
        scoreNum.textContent = '–';
        scoreStars.innerHTML = '<span class="star">★</span><span class="star">★</span><span class="star">★</span><span class="star">★</span><span class="star">★</span>';
        scoreLabel.textContent = 'No reviews yet';
        scoreBased.textContent = 'Based on 0 reviews';
      }
      function starSpans(n) {
        var s = '';
        for (var i = 0; i < 5; i++) s += '<span class="star' + (i < n ? '' : ' empty') + '">★</span>';
        return s;
      }
      function cardHtml(r, isEmpty) {
        return '<div class="review-card' + (isEmpty ? ' empty-state' : '') + '">' +
          '<div class="stars">' + starSpans(Number(r.rating)) + '</div>' +
          '<div class="rating-label">' + ratingLabel(Number(r.rating)) + '</div>' +
          '<div class="text">' + escapeHtml(r.text) + '</div>' +
          '<div class="author-row">' +
            '<div class="author-info"><span class="name">' + escapeHtml(r.author) + '</span><span class="verified">' + (isEmpty ? 'We\'d love your feedback' : 'Verified customer') + '</span></div>' +
          '</div></div>';
      }
      if (items.length === 0) {
        track.innerHTML = cardHtml({ text: 'No reviews yet. Be the first to leave one after your boost!', rating: 5, author: 'TrueTier' }, true);
        return;
      }
      var html = items.map(function(r) { return cardHtml(r, false); }).join('');
      track.innerHTML = html + html;
    });

    db.ref('announcements').orderByChild('createdAt').limitToLast(20).on('value', function(snap) {
      var list = document.getElementById('announcementsList');
      var now = Date.now();
      var items = [];
      snap.forEach(function(c) {
        var v = c.val();
        var expiresAt = v.expiresAt || null;
        if (expiresAt != null && expiresAt < now) return;
        items.push({ title: v.title || '', body: v.body || '' });
      });
      items.reverse();
      if (items.length === 0) {
        list.innerHTML = '<div class="announcement empty">No announcements right now.</div>';
      } else {
        list.innerHTML = items.map(function(a) {
          return '<div class="announcement"><h3>' + escapeHtml(a.title) + '</h3><p>' + escapeHtml(a.body) + '</p></div>';
        }).join('');
      }
    });

    document.getElementById('profileBtn').onclick = function() {
      document.getElementById('profileDrop').classList.toggle('open');
    };
    document.getElementById('btnLogout').onclick = function() {
      auth.signOut();
      window.location.href = '/login';
    };
    document.addEventListener('click', function(e) {
      var wrap = document.getElementById('profileWrap');
      if (wrap && !wrap.contains(e.target)) document.getElementById('profileDrop').classList.remove('open');
    });

    var currentTicketId = null;
    function ticketShowScreen(name) {
      document.getElementById('ticketScreenCreate').style.display = name === 'create' ? 'block' : 'none';
      document.getElementById('ticketScreenList').style.display = name === 'list' ? 'block' : 'none';
      document.getElementById('ticketScreenThread').style.display = name === 'thread' ? 'block' : 'none';
    }
    document.getElementById('btnTicket').onclick = function() {
      document.getElementById('ticketSubject').value = '';
      document.getElementById('ticketMessage').value = '';
      document.getElementById('ticketCreateFiles').value = '';
      currentTicketId = null;
      ticketShowScreen('create');
      document.getElementById('ticketModal').classList.add('show');
    };
    document.getElementById('ticketCancel').onclick = function() {
      document.getElementById('ticketModal').classList.remove('show');
    };
    document.getElementById('ticketModal').onclick = function(e) {
      if (e.target.id === 'ticketModal') document.getElementById('ticketModal').classList.remove('show');
    };
    document.getElementById('btnRequestCall').onclick = function() {
      document.getElementById('callPhone').value = '';
      document.getElementById('callNote').value = '';
      document.getElementById('callModal').classList.add('show');
    };
    document.getElementById('callCancel').onclick = function() {
      document.getElementById('callModal').classList.remove('show');
    };
    document.getElementById('callModal').onclick = function(e) {
      if (e.target.id === 'callModal') document.getElementById('callModal').classList.remove('show');
    };
    document.getElementById('callSubmit').onclick = function() {
      var phone = document.getElementById('callPhone').value.trim();
      if (!phone) { showToast('Please enter your phone number.'); return; }
      var u = auth.currentUser;
      if (!u) return;
      var note = document.getElementById('callNote').value.trim();
      db.ref('callRequests').push({
        userId: u.uid,
        userEmail: u.email,
        phone: phone,
        note: note || null,
        createdAt: firebase.database.ServerValue.TIMESTAMP
      }).then(function() {
        document.getElementById('callModal').classList.remove('show');
        showToast('Request received. We\'ll call you soon.');
      }).catch(function(e) { showToast('Failed: ' + e.message); });
    };
    document.getElementById('ticketShowMy').onclick = function() {
      ticketShowScreen('list');
      var u = auth.currentUser;
      if (!u) return;
      document.getElementById('ticketMyList').innerHTML = '<p class="loading">Loading…</p>';
      db.ref('tickets').orderByChild('userId').equalTo(u.uid).once('value', function(snap) {
        var items = [];
        snap.forEach(function(c) { items.push({ id: c.key, v: c.val() }); });
        items.sort(function(a, b) { return (b.v.createdAt || 0) - (a.v.createdAt || 0); });
        var listEl = document.getElementById('ticketMyList');
        if (items.length === 0) {
          listEl.innerHTML = '<p style="color:var(--text-muted);">No tickets yet. Create one above.</p>';
          return;
        }
        listEl.innerHTML = items.map(function(t) {
          var sub = (t.v.subject || 'No subject');
          var status = t.v.status || 'open';
          var date = t.v.createdAt ? new Date(t.v.createdAt).toLocaleDateString() : '';
          return '<div class="ticket-item" data-tid="' + escapeHtml(t.id) + '">' +
            '<strong>' + escapeHtml(sub) + '</strong><span>' + status + ' · ' + date + '</span></div>';
        }).join('');
        listEl.querySelectorAll('.ticket-item').forEach(function(el) {
          el.onclick = function() {
            currentTicketId = el.getAttribute('data-tid');
            document.getElementById('ticketThreadSubject').textContent = el.querySelector('strong').textContent || 'Ticket';
            document.getElementById('ticketReplyText').value = '';
            ticketShowScreen('thread');
            var msgEl = document.getElementById('ticketThreadMessages');
            msgEl.innerHTML = '<p class="loading">Loading…</p>';
            function attachmentsHtml(arr) {
                if (!arr || !arr.length) return '';
                return '<div class="attachments">' + arr.map(function(a) {
                  return '<a href="' + escapeHtml(a.url) + '" target="_blank" rel="noopener"><img src="' + escapeHtml(a.url) + '" alt=""></a>';
                }).join('') + '</div>';
              }
              db.ref('tickets/' + currentTicketId).on('value', function(s) {
              var v = s.val();
              if (!v) { msgEl.innerHTML = '<p class="err">Ticket not found.</p>'; return; }
              var parts = [];
              parts.push('<div class="ticket-thread-msg">' + escapeHtml(v.message || '') + attachmentsHtml(v.attachments) + '<div class="meta">You · ' + (v.createdAt ? new Date(v.createdAt).toLocaleString() : '') + '</div></div>');
              var replies = v.replies || {};
              var keys = Object.keys(replies).sort(function(a, b) { return (replies[a].createdAt || 0) - (replies[b].createdAt || 0); });
              keys.forEach(function(k) {
                var r = replies[k];
                var who = r.isAdmin ? 'Admin' : 'You';
                parts.push('<div class="ticket-thread-msg' + (r.isAdmin ? ' admin' : '') + '">' + escapeHtml(r.message || '') + attachmentsHtml(r.attachments) + '<div class="meta">' + who + ' · ' + (r.createdAt ? new Date(r.createdAt).toLocaleString() : '') + '</div></div>');
              });
              msgEl.innerHTML = parts.join('');
            });
          };
        });
      });
    };
    document.getElementById('ticketBackToCreate').onclick = function() { ticketShowScreen('create'); };
    document.getElementById('ticketBackToList').onclick = function() {
      if (currentTicketId) db.ref('tickets/' + currentTicketId).off('value');
      ticketShowScreen('list');
      document.getElementById('ticketShowMy').click();
    };
    document.getElementById('ticketReplySubmit').onclick = function() {
      var msg = document.getElementById('ticketReplyText').value.trim();
      if (!msg || !currentTicketId) { showToast('Enter a message.'); return; }
      var u = auth.currentUser;
      if (!u) return;
      var files = document.getElementById('ticketReplyFiles').files;
      var replyData = { message: msg, isAdmin: false, createdAt: firebase.database.ServerValue.TIMESTAMP, attachments: [] };
      db.ref('tickets/' + currentTicketId + '/replies').push(replyData).then(function(ref) {
        var replyId = ref.key;
        if (files.length === 0) {
          db.ref('tickets/' + currentTicketId).update({ status: 'open' });
          document.getElementById('ticketReplyText').value = '';
          document.getElementById('ticketReplyFiles').value = '';
          showToast('Message sent.');
          return;
        }
        var uploads = [];
        var replyNames = [];
        for (var i = 0; i < files.length; i++) {
          if (!files[i].type || files[i].type.indexOf('image') !== 0) continue;
          replyNames.push(files[i].name);
          var path = 'ticketAttachments/' + u.uid + '/' + currentTicketId + '/' + replyId + '/' + files[i].name;
          uploads.push(storage.ref(path).put(files[i]).then(function(s) { return s.ref.getDownloadURL(); }));
        }
        Promise.all(uploads).then(function(urls) {
          var att = urls.map(function(url, idx) { return { url: url, name: replyNames[idx] || 'image' }; });
          return db.ref('tickets/' + currentTicketId + '/replies/' + replyId).update({ attachments: att });
        }).then(function() {
          db.ref('tickets/' + currentTicketId).update({ status: 'open' });
          document.getElementById('ticketReplyText').value = '';
          document.getElementById('ticketReplyFiles').value = '';
          showToast('Message sent.');
        }).catch(function(e) { showToast('Failed: ' + e.message); });
      }).catch(function(e) { showToast('Failed: ' + e.message); });
    };
    document.getElementById('ticketSubmit').onclick = function() {
      var sub = document.getElementById('ticketSubject').value.trim();
      var msg = document.getElementById('ticketMessage').value.trim();
      if (!sub || !msg) { showToast('Please fill subject and message.'); return; }
      var u = auth.currentUser;
      if (!u) return;
      var files = document.getElementById('ticketCreateFiles').files;
      db.ref('tickets').push({
        userId: u.uid,
        userEmail: u.email,
        subject: sub,
        message: msg,
        createdAt: firebase.database.ServerValue.TIMESTAMP,
        status: 'open',
        replies: {},
        attachments: []
      }).then(function(ref) {
        var ticketId = ref.key;
        if (files.length === 0) {
          document.getElementById('ticketModal').classList.remove('show');
          document.getElementById('ticketCreateFiles').value = '';
          showToast('Ticket submitted. We\'ll get back to you soon.');
          return;
        }
        var uploads = [];
        var createNames = [];
        for (var i = 0; i < files.length; i++) {
          if (!files[i].type || files[i].type.indexOf('image') !== 0) continue;
          createNames.push(files[i].name);
          var path = 'ticketAttachments/' + u.uid + '/' + ticketId + '/' + files[i].name;
          uploads.push(storage.ref(path).put(files[i]).then(function(s) { return s.ref.getDownloadURL(); }));
        }
        Promise.all(uploads).then(function(urls) {
          var att = urls.map(function(url, idx) { return { url: url, name: createNames[idx] || 'image' }; });
          return db.ref('tickets/' + ticketId).update({ attachments: att });
        }).then(function() {
          document.getElementById('ticketModal').classList.remove('show');
          document.getElementById('ticketCreateFiles').value = '';
          showToast('Ticket submitted. We\'ll get back to you soon.');
        }).catch(function(e) { showToast('Failed: ' + e.message); });
      }).catch(function(e) { showToast('Failed: ' + e.message); });
    };

    document.getElementById('btnReview').onclick = function() {
      document.getElementById('reviewText').value = '';
      document.getElementById('reviewRating').value = '5';
      document.getElementById('reviewModal').classList.add('show');
    };
    document.getElementById('reviewCancel').onclick = function() {
      document.getElementById('reviewModal').classList.remove('show');
    };
    document.getElementById('reviewModal').onclick = function(e) {
      if (e.target.id === 'reviewModal') document.getElementById('reviewModal').classList.remove('show');
    };
    document.getElementById('reviewSubmit').onclick = function() {
      var text = document.getElementById('reviewText').value.trim();
      var rating = document.getElementById('reviewRating').value;
      if (!text) { showToast('Please write a review.'); return; }
      var u = auth.currentUser;
      if (!u) return;
      db.ref('users/' + u.uid + '/badges/customer').once('value', function(snap) {
        if (!snap.val()) {
          showToast('Only customers can leave reviews.');
          return;
        }
        db.ref('users/' + u.uid).once('value', function(s) {
          var d = s.val();
          db.ref('reviews').push({
            userId: u.uid,
            displayName: d && d.displayName ? d.displayName : u.email.split('@')[0],
            text: text,
            rating: Number(rating),
            createdAt: firebase.database.ServerValue.TIMESTAMP
          }).then(function() {
            document.getElementById('reviewModal').classList.remove('show');
            showToast('Thank you! Your review is live.');
          }).catch(function(e) { showToast('Failed: ' + e.message); });
        });
      });
    };
  </script>
</body>
</html>
